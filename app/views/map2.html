<!-- begin: gMap -->
<google-map center='mapConfig.center' zoom="mapConfig.zoom" options="mapConfig.options" draggable="true" id="gmap">

<!-- begin: visualisation of data from panel 1 in map -->
<div data-ng-repeat="seq in rawStopsSequences" ng-switch on="seq.properties.visible">
  <div ng-switch-when="true">
    <markers
        models="seq.data"
        coords="'self'"
        options="seq.properties.matchingStatus === 'matched' ? mapConfig.roundMarkers.green : mapConfig.roundMarkers.red "
        labelContent="'cntSequence'"
        labelAnchor="4 24"
        labelClass="marker-label">

      <!-- begin: marker details overlay window -->
      <windows show="'showWindow'" closeClick="'closeClick'" ng-cloak>
        <table data-ng-non-bindable>
          <tr>
            <td>arrival</td>
            <td>{{arrivalAsString}}</td>
          </tr>
          <tr>
            <td>departure</td>
            <td>{{departureAsString}}</td>
          </tr>
          <tr>
            <td>latitude</td>
            <td>{{ latitude | number:8 }}</td>
          </tr>
          <tr>
            <td>longitude</td>
            <td>{{longitude | number:8 }}</td>
          </tr>
          <tr>
            <td>distance</td>
            <td>{{distance}}</td>
          </tr>
          <tr>
            <td>cntStopKey</td>
            <td>{{cntStopKey}}</td>
          </tr>
          <tr>
            <td>cntTripKey</td>
            <td>{{cntTripKey}}</td>
          </tr>
          <tr>
            <td>cntSequence</td>
            <td>{{cntSequence}}</td>
          </tr>
          <tr>
            <td>rawId</td>
            <td>{{rawId}}</td>
          </tr>
          <tr>
            <td>rawStopId</td>
            <td>{{rawStopId}}</td>
          </tr>
        </table>
      </windows>
      <!-- end: marker details overlay window -->

    </markers>
    <polyline path="seq.data"
              stroke="seq.properties.matchingStatus === 'matched' ? mapConfig.lines.green : mapConfig.lines.red"></polyline>
  </div>
</div>
<!-- end: visualisation of data from panel 1 in map -->

<!-- begin: visualisation of data from panel 2 in map -->
<div data-ng-repeat="seq in plannedStopsSequencesOfMatchedBlock" ng-switch on="seq.properties.visible">
  <div ng-switch-when="true">
    <markers
        models="seq.data"
        coords="'self'"
        options="mapConfig.roundMarkers.blue"
        labelContent="'sequence'"
        labelAnchor="10 0"
        labelClass="marker-label">

      <!-- begin: marker details overlay window -->
      <windows show="'showWindow'" closeClick="'closeClick'" ng-cloak>
        <table data-ng-non-bindable>
          <tr>
            <td>blockLabel</td>
            <td>{{blockLabel}}</td>
          </tr>
          <tr>
            <td>pointLabel</td>
            <td>{{pointLabel}}</td>
          </tr>
          <tr>
            <td>blockKey</td>
            <td>{{blockKey}}</td>
          </tr>
          <tr>
            <td>tripKey</td>
            <td>{{tripKey}}</td>
          </tr>
          <tr>
            <td>tripTypId</td>
            <td>{{tripTypId}}</td>
          </tr>
          <tr>
            <td>sequence</td>
            <td>{{sequence}}</td>
          </tr>
          <tr>
            <td>departure</td>
            <td>{{departureAsString}}</td>
          </tr>
          <tr>
            <td>latitude</td>
            <td>{{ latitude }}</td>
          </tr>
          <tr>
            <td>longitude</td>
            <td>{{longitude}}</td>
          </tr>
          <tr>
            <td>distance</td>
            <td>{{distance}}</td>
          </tr>
          <tr>
            <td>numberStops</td>
            <td>{{numberStops}}</td>
          </tr>
        </table>
      </windows>
      <!-- end: marker details overlay window -->

    </markers>
    <polyline path="seq.data" stroke="mapConfig.lines.blue"></polyline>
  </div>
</div>
<!-- end: visualisation of data from panel 2 in map -->

<!-- begin: visualisation of data from panel 3 in map -->
<div data-ng-repeat="seq in plannedStopsSequencesOfSelectedBlock" ng-switch on="seq.properties.visible">
  <div ng-switch-when="true">
    <markers
        models="seq.data"
        coords="'self'"
        options="mapConfig.roundMarkers.blue"
        labelContent="'sequence'"
        labelAnchor="10 0"
        labelClass="marker-label">

      <!-- begin: marker details overlay window -->
      <windows show="'showWindow'" closeClick="'closeClick'" ng-cloak>
        <table data-ng-non-bindable>
          <tr>
            <td>blockLabel</td>
            <td>{{blockLabel}}</td>
          </tr>
          <tr>
            <td>pointLabel</td>
            <td>{{pointLabel}}</td>
          </tr>
          <tr>
            <td>blockKey</td>
            <td>{{blockKey}}</td>
          </tr>
          <tr>
            <td>tripKey</td>
            <td>{{tripKey}}</td>
          </tr>
          <tr>
            <td>sequence</td>
            <td>{{sequence}}</td>
          </tr>
          <tr>
            <td>arrival</td>
            <td>{{arrivalAsString}}</td>
          </tr>
          <tr>
            <td>departure</td>
            <td>{{departureAsString}}</td>
          </tr>
          <tr>
            <td>latitude</td>
            <td>{{ latitude | number:8 }}</td>
          </tr>
          <tr>
            <td>longitude</td>
            <td>{{longitude | number:8 }}</td>
          </tr>
          <tr>
            <td>distance</td>
            <td>{{distance}}</td>
          </tr>
          <tr>
            <td>numberStops</td>
            <td>{{numberStops}}</td>
          </tr>
        </table>
      </windows>
      <!-- end: marker details overlay window -->

    </markers>
    <polyline path="seq.data" stroke="mapConfig.lines.blue"></polyline>
  </div>
</div>
<!-- end: visualisation of data from panel 3 in map -->

</google-map>
<!-- end: gMap -->

<!-- begin: left panel -->
<div class="map-panel-wrapper">
  <h4 class="map-panel-header">Stop sequences for vehicle {{vehicleId}} at {{isoDate}}</h4>

  <div class="accordion">

    <!-- begin: panel 1 -->
    <div class="accordion__item">
      <div class="accordion__header active" data-accordion-header>
        <h4 class="accordion__title">Found stop sequences</h4>
        <span class="accordion__header-icon"></span>
      </div>
      <div class="accordion__body active">
        <div class="loading-spinner" data-ng-show="spinner[0]">
          <div class="loading-spinner__spinner"></div>
        </div>

        <div class="flex-table">
          <div class="flex-table__row">
            <div class="flex-table__col flex-table__col--header"></div>
            <div class="flex-table__col flex-table__col--header"></div>
            <div class="flex-table__col flex-table__col--header">Departure</div>
            <div class="flex-table__col flex-table__col--header">Trip</div>
            <div class="flex-table__col flex-table__col--header">Block</div>
            <div class="flex-table__col flex-table__col--header">Stops</div>
          </div>
          <div data-ng-repeat="seq in rawStopsSequences">
            <div class="flex-table__row" data-ng-class="seq.properties.matchingStatus === 'matched' ? 'green' : 'red' ">
              <div class="flex-table__col">
                <input
                    type="checkbox"
                    data-ng-model="seq.properties.visible"
                    data-ng-checked="false"
                    data-ng-true-value="true"
                    data-ng-false-value="false"
                    />
              </div>
              <div class="flex-table__col"><span class="toggle-btn"
                                                 data-ng-class="{'toggle-btn--open' : seq.properties.showStopsInTable}"
                                                 data-ng-click="toggleStopsOfSequence(seq.properties)"></span></div>
              <div class="flex-table__col">{{ seq.properties.departureTime }}</div>
              <div class="flex-table__col">{{ seq.properties.tripLabel || "unmatched" }}</div>
              <div class="flex-table__col">{{ seq.properties.blockLabel || "unmatched" }}</div>
              <div class="flex-table__col">{{seq.data.length}}</div>
            </div>
            <div data-ng-show="seq.properties.showStopsInTable">
              <div data-ng-repeat="stop in seq.data" class="flex-table__row flex-table__row--stops">
                <div class="flex-table__col"></div>
                <div class="flex-table__col"></div>
                <div class="flex-table__col">{{ stop.departureAsString | timeOnlyFilter }}</div>
                <div class="flex-table__col">{{ stop.sclTripLabel || "unmatched" }}</div>
                <div class="flex-table__col">{{ stop.sclBlockLabel || "unmatched" }}</div>
                <div class="flex-table__col">{{ stop.cntSequence}}</div>
              </div>
            </div>
          </div>
        </div>

        <p><span class="green">matched</span> / <span class="red">unmatched</span></p>
      </div>
    </div>
    <!-- end: panel 1 -->

    <!-- begin: panel 2 -->
    <div class="accordion__item">
      <div class="accordion__header active" data-accordion-header>
        <h4 class="accordion__title">Scheduled trips of matching block</h4>
        <span class="accordion__header-icon"></span>
      </div>
      <div class="accordion__body active">
        <div class="loading-spinner" data-ng-show="spinner[1]">
          <div class="loading-spinner__spinner"></div>
        </div>

        <select class="full-width"
                data-ng-model="selectedMatchingBlock"
                data-ng-options="block as block.properties.blockLabel for block in matchingBlocks">
        </select>

        <table class="panel-table" data-ng-show="plannedStopsSequencesOfMatchedBlock">
          <tr>
            <th>&nbsp;</th>
            <th>Departure</th>
            <th>Trip label</th>
            <th>Stops</th>
          </tr>
          <tr data-ng-repeat="seq in plannedStopsSequencesOfMatchedBlock" data-ng-switch
              data-on="seq.properties.visible"
              class="blue">
            <td>
              <input
                  type="checkbox"
                  data-ng-model="seq.properties.visible"
                  data-ng-checked="false"
                  data-ng-true-value="true"
                  data-ng-false-value="false"
                  />
            </td>
            <td>{{ seq.properties.departureTime }}</td>
            <td>{{ seq.properties.tripLabel }}</td>
            <td>{{seq.data.length}}</td>
          </tr>
        </table>
      </div>
    </div>
    <!-- end: panel 2 -->

    <!-- begin: panel 3 -->
    <div class="accordion__item">
      <div class="accordion__header" data-accordion-header>
        <h4 class="accordion__title">All Blocks for this day ({{isoDate}})</h4>
        <span class="accordion__header-icon"></span>
      </div>
      <div class="accordion__body">
        <div class="loading-spinner" data-ng-show="spinner[2]">
          <div class="loading-spinner__spinner"></div>
        </div>
        <form data-ng-submit="submitBlockForm()">
          <div class="box">
            <div class="box__header">Filter available blocks</div>
            <div class="box__body">
              <input type="text" data-ng-model="blockFilter.label"/>
            </div>
          </div>

          <p>
            <select class="full-width"
                    size="5"
                    data-ng-model="selectedBlock"
                    data-ng-options="block.blockLabel for block in blocksOfDay | filter:{ blockLabel: blockFilter.label }">
            </select>
          </p>

          <p>
            <button>Show stop sequences</button>
          </p>
        </form>

        <table class="panel-table" data-ng-show="plannedStopsSequencesOfSelectedBlock">
          <tr>
            <th></th>
            <th>Departure</th>
            <th>Trip label</th>
            <th>Stops</th>
          </tr>
          <tr data-ng-repeat="seq in plannedStopsSequencesOfSelectedBlock" data-ng-switch
              data-on="seq.properties.visible"
              class="blue">
            <td>
              <input
                  type="checkbox"
                  data-ng-model="seq.properties.visible"
                  data-ng-checked="false"
                  data-ng-true-value="true"
                  data-ng-false-value="false"
                  />
            </td>
            <td>{{ seq.properties.departureTime }}</td>
            <td>{{ seq.properties.tripLabel }}</td>
            <td>{{seq.data.length}}</td>
          </tr>
        </table>
      </div>
    </div>
    <!-- end: panel 3 -->

  </div>
</div>
<!-- end: left panel -->
