<!-- begin: gMap -->
<google-map center='mapConfig.center' zoom="mapConfig.zoom" options="mapConfig.options" draggable="true" id="gmap">
  <div data-ng-repeat="seq in rawStopsSequences" ng-switch on="seq.properties.visible">
    <div ng-switch-when="true">
      <markers
          models="seq.data"
          coords="'self'"
          options="seq.properties.matchingStatus === 'matched' ? mapConfig.roundMarkers.green : mapConfig.roundMarkers.red "
          labelContent="'cntSequence'"
          labelAnchor="4 24"
          labelClass="marker-label">
        <windows show="'showWindow'" closeClick="'closeClick'" ng-cloak>

          <table data-ng-non-bindable>
            <tr>
              <td>arrival</td>
              <td>{{arrivalAsString}}</td>
            </tr>
            <tr>
              <td>departure</td>
              <td>{{departureAsString}}</td>
            </tr>
            <tr>
              <td>latitude</td>
              <td>{{ latitude | number:8 }}</td>
            </tr>
            <tr>
              <td>longitude</td>
              <td>{{longitude | number:8 }}</td>
            </tr>
            <tr>
              <td>distance</td>
              <td>{{distance}}</td>
            </tr>
            <tr>
              <td>cntStopKey</td>
              <td>{{cntStopKey}}</td>
            </tr>
            <tr>
              <td>cntTripKey</td>
              <td>{{cntTripKey}}</td>
            </tr>
            <tr>
              <td>cntSequence</td>
              <td>{{cntSequence}}</td>
            </tr>
            <tr>
              <td>rawId</td>
              <td>{{rawId}}</td>
            </tr>
            <tr>
              <td>rawStopId</td>
              <td>{{rawStopId}}</td>
            </tr>
          </table>

        </windows>
      </markers>
      <polyline path="seq.data"
                stroke="seq.properties.matchingStatus === 'matched' ? mapConfig.lines.green : mapConfig.lines.red"></polyline>
    </div>
  </div>


  <div data-ng-repeat="seq in plannedStopsSequencesOfMatchedBlock" ng-switch on="seq.properties.visible">
    <div ng-switch-when="true">
      <markers
          models="seq.data"
          coords="'self'"
          options="mapConfig.roundMarkers.blue"
          labelContent="'sequence'"
          labelAnchor="10 0"
          labelClass="marker-label">
        <windows show="'showWindow'" closeClick="'closeClick'" ng-cloak>

          <table data-ng-non-bindable>
            <tr>
              <td>blockLabel</td>
              <td>{{blockLabel}}</td>
            </tr>
            <tr>
              <td>pointLabel</td>
              <td>{{pointLabel}}</td>
            </tr>
            <tr>
              <td>blockKey</td>
              <td>{{blockKey}}</td>
            </tr>
            <tr>
              <td>tripKey</td>
              <td>{{tripKey}}</td>
            </tr>
            <tr>
              <td>tripTypId</td>
              <td>{{tripTypId}}</td>
            </tr>
            <tr>
              <td>sequence</td>
              <td>{{sequence}}</td>
            </tr>
            <tr>
              <td>departure</td>
              <td>{{departureAsString}}</td>
            </tr>
            <tr>
              <td>latitude</td>
              <td>{{ latitude }}</td>
            </tr>
            <tr>
              <td>longitude</td>
              <td>{{longitude}}</td>
            </tr>
            <tr>
              <td>distance</td>
              <td>{{distance}}</td>
            </tr>
            <tr>
              <td>numberStops</td>
              <td>{{numberStops}}</td>
            </tr>

          </table>

        </windows>
      </markers>
      <polyline path="seq.data" stroke="mapConfig.lines.blue"></polyline>
    </div>
  </div>

  <div data-ng-repeat="seq in plannedStopsSequencesOfSelectedBlock" ng-switch on="seq.properties.visible">
    <div ng-switch-when="true">
      <markers
          models="seq.data"
          coords="'self'"
          options="mapConfig.roundMarkers.blue"
          labelContent="'sequence'"
          labelAnchor="10 0"
          labelClass="marker-label">
        <windows show="'showWindow'" closeClick="'closeClick'" ng-cloak>

          <table data-ng-non-bindable>
            <tr>
              <td>blockLabel</td>
              <td>{{blockLabel}}</td>
            </tr>
            <tr>
              <td>pointLabel</td>
              <td>{{pointLabel}}</td>
            </tr>
            <tr>
              <td>blockKey</td>
              <td>{{blockKey}}</td>
            </tr>
            <tr>
              <td>tripKey</td>
              <td>{{tripKey}}</td>
            </tr>
            <tr>
              <td>tripTypId</td>
              <td>{{tripTypId}}</td>
            </tr>
            <tr>
              <td>sequence</td>
              <td>{{sequence}}</td>
            </tr>
            <tr>
              <td>departure</td>
              <td>{{departureAsString}}</td>
            </tr>
            <tr>
              <td>latitude</td>
              <td>{{ latitude | number:8 }}</td>
            </tr>
            <tr>
              <td>longitude</td>
              <td>{{longitude | number:8 }}</td>
            </tr>
            <tr>
              <td>distance</td>
              <td>{{distance}}</td>
            </tr>
            <tr>
              <td>numberStops</td>
              <td>{{numberStops}}</td>
            </tr>

          </table>

        </windows>
      </markers>
      <polyline path="seq.data" stroke="mapConfig.lines.blue"></polyline>
    </div>
  </div>

</google-map>
<!-- end: gMap -->

<!-- begin: left panel -->
<div class="map-panel-wrapper">
  <h4 class="map-panel-header">Stop sequences for vehicle {{vehicleId}} at {{date}}</h4>

  <div class="accordion">
    <div class="accordion__item">
      <div class="accordion__header active" data-accordion-header>
        <h4 class="accordion__title">Found stop sequences</h4>
        <span class="accordion__header-icon"></span>
      </div>
      <div class="accordion__body active">
        <div class="loading-spinner" data-ng-show="spinner[0]">
          <div class="loading-spinner__spinner"></div>
        </div>
        <!--<p>Date: <strong>{{date}}</strong>, Vehicle: <strong>{{vehicleId}}</strong></p>-->
        <table class="panel-table"  data-ng-show="rawStopsSequences">
          <tr>
            <th>Show</th>
            <th>Departure</th>
            <th>Trip key</th>
            <th>Stops</th>
          </tr>
          <tr data-ng-repeat="seq in rawStopsSequences" data-ng-switch data-on="seq.properties.visible"
              data-ng-class="seq.properties.matchingStatus === 'matched' ? 'green' : 'red' ">
            <td>
              <input
                  type="checkbox"
                  data-ng-model="seq.properties.visible"
                  data-ng-checked="false"
                  data-ng-true-value="true"
                  data-ng-false-value="false"
                  />
            </td>
            <td>{{ seq.properties.departureTime }}</td>
            <td>{{ seq.properties.tripKey }}</td>
            <td>{{seq.data.length}}</td>
          </tr>
        </table>
        <p><span class="green">matched</span> / <span class="red">unmatched</span></p>
      </div>
    </div>

    <div class="accordion__item">
      <div class="accordion__header active" data-accordion-header>
        <h4 class="accordion__title">Stop sequences of matching block&nbsp;({{matchedBlockLabel}})</h4>
        <span class="accordion__header-icon"></span>
      </div>
      <div class="accordion__body active">
        <div class="loading-spinner" data-ng-show="spinner[1]">
          <div class="loading-spinner__spinner"></div>
        </div>
        <table class="panel-table" data-ng-show="plannedStopsSequencesOfMatchedBlock">
          <tr>
            <th>Show</th>
            <th>Departure</th>
            <th>Trip label</th>
            <th>Stops</th>
          </tr>
          <tr data-ng-repeat="seq in plannedStopsSequencesOfMatchedBlock" data-ng-switch
              data-on="seq.properties.visible"
              class="blue">
            <td>
              <input
                  type="checkbox"
                  data-ng-model="seq.properties.visible"
                  data-ng-checked="false"
                  data-ng-true-value="true"
                  data-ng-false-value="false"
                  />
            </td>
            <td>{{ seq.properties.departureTime }}</td>
            <td>{{ seq.properties.tripLabel }}</td>
            <td>{{seq.data.length}}</td>
          </tr>
        </table>
      </div>
    </div>

    <div class="accordion__item">
      <div class="accordion__header" data-accordion-header>
        <h4 class="accordion__title">All Blocks for this day ({{isoDate}})</h4>
        <span class="accordion__header-icon"></span>
      </div>
      <div class="accordion__body">
        <div class="loading-spinner" data-ng-show="spinner[2]">
          <div class="loading-spinner__spinner"></div>
        </div>
        <form data-ng-submit="submitBlockForm()">
          <div class="box">
            <div class="box__header">Filter available blocks</div>
            <div class="box__body">
              <input type="text" data-ng-model="blockFilter.label"/>
            </div>
          </div>

          <p>
            <select class="full-width"
                    size="5"
                    data-ng-model="selectedBlock"
                    data-ng-options="block.blockLabel for block in blocksOfDay | filter:{ blockLabel: blockFilter.label }">
            </select>
          </p>

          <p>
            <button>Show stop sequences</button>
          </p>
        </form>

        <table class="panel-table" data-ng-show="plannedStopsSequencesOfSelectedBlock">
          <tr>
            <th>Show</th>
            <th>Departure</th>
            <th>Trip label</th>
            <th>Stops</th>
          </tr>
          <tr data-ng-repeat="seq in plannedStopsSequencesOfSelectedBlock" data-ng-switch
              data-on="seq.properties.visible"
              class="blue">
            <td>
              <input
                  type="checkbox"
                  data-ng-model="seq.properties.visible"
                  data-ng-checked="false"
                  data-ng-true-value="true"
                  data-ng-false-value="false"
                  />
            </td>
            <td>{{ seq.properties.departureTime }}</td>
            <td>{{ seq.properties.tripLabel }}</td>
            <td>{{seq.data.length}}</td>
          </tr>
        </table>
      </div>
    </div>


  </div>
</div>
<!-- end: left panel -->
